<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>feedpress</title>

	<script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
	<script>
		function pageData() {
			return {
				isLoading: false,	// An indicator to show we are awaiting something
				config: null,		// Press configuration loaded after entering the config tab
				showingTab: 1,		// The navigation tab currently showing
				search: "",			// The feed we are searching for
				fetchConfig() {
					this.isLoading = true;
					fetch(`http://localhost:8081/api/config`)
					.then(res => res.json())
					.then(data => {
						this.isLoading = false;
						this.config = data;
					});
				},
				get filteredFeeds() {
					if (this.config === null) {
						return null;
					}
					if (this.search === "") {
						return this.config.feed;
					}
					return this.config.feed.filter((item) => {
						return item.url.toLowerCase().includes(this.search.toLowerCase());
					});
				},
			}
		}

	</script>
	<link href="./output.css" rel="stylesheet">
</head>
<body class="h-full">
	<div x-data="pageData()">
		<!-- Thank you: https://5balloons.info/building-a-responsive-navigation-using-tailwindcss-and-alpinejs/ -->
		<nav class="border-b">
			<div x-data="{showMenu : false}" class="container max-w-screen-lg mx-auto flex justify-between h-14">
				<!-- Brand-->
				<a href="#" class="flex items-center cursor-pointer hover:bg-purple-50 px-2 ml-3">
					<!-- Logo-->
					<div class="rounded bg-gray-400 text-white font-bold w-10 h-10 flex justify-center text-3xl pt-0.5">F</div>
					<div class="text-gray-700 font-semibold ml-2">FeedPress</div>
				</a>
				<!-- Navbar Toggle Button -->
				<button @click="showMenu = !showMenu" class="block md:hidden text-gray-700 p-2 rounded hover:border focus:border focus:bg-gray-100 my-2 mr-5" type="button" aria-controls="navbar-main" aria-expanded="false" aria-label="Toggle navigation">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
				</button>
				<!-- Nav Links-->
				<ul class="md:flex text-gray-700 text-base mr-3 origin-top"
					:class="{ 'block absolute top-14 border-b bg-white w-full p-2': showMenu, 'hidden': !showMenu}"
					id="navbar-main" x-cloak>
					<li class="px-3 cursor-pointer hover:bg-purple-50 flex items-center hover:text-gray-800" :class="showMenu && 'py-1'">
						<a href="#" @click="showingTab=1">Home</a>
					</li>
					<li class="px-3 cursor-pointer hover:bg-purple-50 flex items-center hover:text-gray-800" :class="showMenu && 'py-1'">
						<a href="#" @click="fetchConfig(); showingTab=2">Configuration</a>
					</li>
					<li class="px-3 cursor-pointer hover:bg-purple-50 flex items-center hover:text-gray-800" :class="showMenu && 'py-1'">
						<a href="#" @click="showingTab=3">About</a>
					</li>
				</ul>
			</div>
		</nav>

		<!-- Site Content -->
		<div x-show="showingTab==1">


		</div>
		<div x-show="showingTab==2">
			<div x-show="!isLoading" x-collapse.duration.500ms>
				<template x-if="config">
					<div >
						<div x-data="{open:false}" class="w-[50vw] mx-auto border-b bg-blue-50">
							<div class="flex justify-between items-center bg-gray-200 border-b" @click="open=!open" >
								<p class="px-4">General Configuration</p>
								<button @click="open=!open" x-html="open ? '-' :'+' " class="px-2 text-black hover:text-gray-500 font-bold text-3xl"></button>
							</div>
							<div x-show="open" x-cloak class="mt-10 grid grid-cols-1 gap-x-1 gap-y-1 sm:grid-cols-2 mx-1 py-1" x-transition>
								<!-- General configuration content -->
									<div class="text-sm leading-6">
										<label for="cbErrors" class="font-medium text-gray-900">Show Errors</label>
									</div>
									<div class="flex h-6 items-center">
										<input id="cbErrors" name="cbErrors" type="checkbox" x-model="config.show_errors" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600">
									</div>
									
									<div class="sm:col-span-2">
										<label for="txtMaxAge" class="block text-sm font-medium leading-6 text-gray-900">Max Age</label>
										<div class="mt-2">
										<input x-model="config.max_age" type="text" name="txtMaxAge" id="txtMaxAge" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
										</div>
									</div>

									<div class="sm:col-span-2">
										<label for="txtFeedLimit" class="block text-sm font-medium leading-6 text-gray-900">Feed Limit</label>
										<div class="mt-2">
										<input x-model="config.feed_limit" type="text" name="txtFeedLimit" id="txtFeedLimit" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
										</div>
									</div>
							</div>
							<hr>
						</div>
						<div x-data="{open:false}" class="w-[50vw] mx-auto border-b bg-blue-50">
							<div class="flex justify-between items-center bg-gray-200 border-b" @click="open=!open">
								<p class="px-4">Feed Listing</p>
								<button @click="open=!open" x-html="open ? '-' :'+' " class="px-2 text-black hover:text-gray-500 font-bold text-3xl"></button>
							</div>
							<div x-show="open" x-cloak class="mx-4 py-4" x-transition>

								<!-- Go through each item in config.feed and present a card with its data -->
								<div class="container pt-8 mx-auto">
									<!-- Search / Filter input -->
									<input
										x-ref="searchField"
										x-model="search"
										x-on:keydown.window.prevent.slash="$refs.searchField.focus()"
										placeholder="Search for a feed..."
										type="search"
										class="block w-full bg-gray-50 focus:outline-none focus:bg-white focus:shadow text-gray-700 rounded-lg px-4 py-3"/>
								
									<!-- Cards here -->
									<div class="mt-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
										<template x-for="item in filteredFeeds" :key="item.url">
											<div class="flex items-center shadow bg-blue-150 hover:bg-indigo-100 hover:shadow-lg hover:rounded transition duration-150 ease-in-out transform hover:scale-105 p-3">
												<div class="text-sm text-gray-900 ">
													<p class="leading-none">URL: <span x-text="item.url"></span></p>
													<p class="leading-none">Max Age: <span x-text="item.max_age"></span></p>
													<p class="leading-none">Feed Limit: <span x-text="item.feed_limit"></span></p>
													<p class="leading-none">Category: <span x-text="item.section"></span></p>
												</div>
											</div>
										</template>
									</div>
								</div>
							</div>
							<hr>
						</div>
					</div>
				</template>
			</div>
		</div>
		<div x-show="showingTab==3">
			About
		</div>
	</div>

</body>
</html>